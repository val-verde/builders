#!/bin/bash

set -e

# Set all environment vars
export SOURCE_PACKAGE_NAME=m4
export SOURCE_PACKAGE_VERSION=1

# Source package build helper functions
source /usr/libexec/${VAL_VERDE_GH_TEAM}-platform-sdk-builder-utils

# Configure the build components
if [ "${HOST_OS}" = "gnu" ]; then
    export CFLAGS=`${ECHO} "\
        -D_IO_ftrylockfile=1 \
        -D_IO_IN_BACKUP=0x100 \
        ${CFLAGS} \
    " | ${XARGS}`
fi

mkdir -p ${STAGE_ROOT}/bin
create-host-tool ${BINDIR}/true NOFLAGS ${STAGE_ROOT}/bin/help2man

# Invoke one-shot template for stage/configure/install
PATH=${STAGE_ROOT}/bin:$PATH \
package-stage-configure-install-archive
