#!/bin/bash

set -e

# Source package build helper functions
source /usr/libexec/${VAL_VERDE_GH_TEAM}-platform-sdk-builder-api

# spirv headers build
package-invoke-builder spirv-headers-cross 1

# spirv tools build
package-invoke-builder spirv-tools-cross 2021

# spirv cross build
package-invoke-builder spirv-cross-cross 2021

# spirv llvm translator build
package-invoke-builder spirv-llvm-translator-cross 13

# glslang build
package-invoke-builder glslang-cross 10-11

if [ "${HOST_OS}" = "macos" ]; then
    # moltenvk build
    package-invoke-builder moltenvk-cross 1
else
    # vulkan tools build
    package-invoke-builder vulkan-tools-cross 1
fi

# vulkan validation layers build
package-invoke-builder vulkan-validation-layers-cross 1

# libclc build
ENABLE_STAGE_ROOT_BUILD=TRUE \
package-invoke-builder libclc-cross 13

if [ "${HOST_OS}" = "gnu" ] ||
   [ "${HOST_OS}" = "macos" ] ||
   [ "${HOST_OS}" = "mingw32" ] ||
   [ "${HOST_OS}" = "musl" ]; then
    # mesa build
    package-invoke-builder mesa-cross 21
fi

# libepoxy build
package-invoke-builder libepoxy-cross 1

if [ "${HOST_OS}" = "macos" ]; then
    # libapplewm build
    package-invoke-builder libapplewm-cross 1
fi

if [ "${HOST_OS}" = "gnu" ] ||
   [ "${HOST_OS}" = "macos" ] ||
   [ "${HOST_OS}" = "musl" ]; then
    # xorg-xserver build
    package-invoke-builder xorg-xserver-cross 1

    # mesa glu build
    package-invoke-builder mesa-glu-cross 9
fi

if [ "${HOST_OS}" = "gnu" ] ||
   [ "${HOST_OS}" = "macos" ] ||
   [ "${HOST_OS}" = "mingw32" ] ||
   [ "${HOST_OS}" = "musl" ]; then
    # freeglut build
    package-invoke-builder freeglut-cross 3

    # glew build
    package-invoke-builder glew-cross 2
fi

if [ "${HOST_OS}" = "gnu" ] ||
   [ "${HOST_OS}" = "macos" ] ||
   [ "${HOST_OS}" = "musl" ]; then
    # mesa demos build
    package-invoke-builder mesa-demos-cross 8
fi

# glfw build
package-invoke-builder glfw-cross 3

# tk build
package-invoke-builder tk-cross 8

# libsass build
package-invoke-builder libsass-cross 3

if [ "${HOST_OS}" = "gnu" ] ||
   [ "${HOST_OS}" = "macos" ] ||
   [ "${HOST_OS}" = "mingw32" ] ||
   [ "${HOST_OS}" = "musl" ]; then
    # gtk build
    package-invoke-builder gtk-cross 4
fi

if [ "${HOST_OS}" = "gnu" ] ||
   [ "${HOST_OS}" = "musl" ]; then
    # mtdev build
    package-invoke-builder mtdev-cross 1

    # libgudev build
    package-invoke-builder libgudev-cross 1
    
    # libwacom build
    package-invoke-builder libwacom-cross 1
    
    # libevdev build
    package-invoke-builder libevdev-cross 1
    
    # libinput build
    package-invoke-builder libinput-cross 1
    
    # seatd build
    package-invoke-builder seatd-cross 0
    
    # wlroots build
    package-invoke-builder wlroots-cross 0
    
    # sway build
    package-invoke-builder sway-cross 1
fi

# sdl build
package-invoke-builder sdl-cross 2

# sdl-image build
package-invoke-builder sdl-image-cross 2

# sdl-mixer build
package-invoke-builder sdl-mixer-cross 2

# sdl-net build
package-invoke-builder sdl-net-cross 2

# sdl-ttf build
package-invoke-builder sdl-ttf-cross 2

# filament build
ENABLE_STAGE_ROOT_BUILD=TRUE \
package-invoke-builder filament-cross 1

# eigen build
package-invoke-builder eigen-cross 3

# ceres-solver build
package-invoke-builder ceres-solver-cross 2

# opencv build
package-invoke-builder opencv-cross 4
