#!/bin/bash

set -e

# Set all environment vars
export SOURCE_PACKAGE_NAME=perl
export SOURCE_PACKAGE_VERSION=5

# Source package build helper functions
source /usr/libexec/${VAL_VERDE_GH_TEAM}-platform-sdk-builder-utils

# Configure the build components
cd ${STAGE_ROOT}
copy-source-to-staging
export-compiler-environment

TOOL_LOG=builder-invocation \
tool-log ${STAGE_ROOT}/Configure \
    -d \
    -e \
    -s \
    -Dar=${AR} \
    -Das=${AS} \
    -Dcc=${CC} \
    -Dccflags="${CFLAGS}" \
    -Dcxx=${CXX} \
    -Dcxxflags="${CXXFLAGS}" \
    -Dincpth=${PACKAGE_PREFIX}/include \
    -Dld=${LD} \
    -Dldflags="${LDFLAGS}" \
    -Dlibpth=${PACKAGE_PREFIX}/lib \
    -Dnm=${NM} \
    -Dprefix=${PACKAGE_PREFIX} \
    -Dranlib=${RANLIB} \
    -Dsiteprefix=${PACKAGE_PREFIX}/local \
    -Dsysroot=${SYSROOT} \
    -Dusrinc=${PACKAGE_PREFIX}/include \
    -Dvendorprefix=${PACKAGE_PREFIX}

# Build the components
make-install

# Build and install the package
package-invoke-archive-install