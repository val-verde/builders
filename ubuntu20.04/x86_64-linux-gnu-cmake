#!/bin/bash

PACKAGE_BINROOT=${PACKAGE_ROOT}/bin
CLANG_COMMON_ARGS="-march=haswell -mtune=haswell -Oz"
LLD_COMMON_ARGS="-s -O2"

cmake \
    -G Ninja \
    -DCMAKE_AR=${PACKAGE_BINROOT}/llvm-ar \
    -DCMAKE_AS=${PACKAGE_BINROOT}/llvm-as \
    -DCMAKE_BUILD_TYPE=MinSizeRel \
    -DCMAKE_C_COMPILER=${PACKAGE_BINROOT}/clang \
    -DCMAKE_C_FLAGS_MINSIZEREL="${CLANG_COMMON_ARGS}" \
    -DCMAKE_CXX_COMPILER=${PACKAGE_BINROOT}/clang++ \
    -DCMAKE_CXX_FLAGS_MINSIZEREL="${CLANG_COMMON_ARGS}" \
    -DCMAKE_EXE_LINKER_FLAGS="${LLD_COMMON_ARGS}" \
    -DCMAKE_LINKER=${PACKAGE_BINROOT}/ld.lld \
    -DCMAKE_MODULE_LINKER_FLAGS="${LLD_COMMON_ARGS}" \
    -DCMAKE_NM=${PACKAGE_BINROOT}/llvm-nm \
    -DCMAKE_OBJCOPY=${PACKAGE_BINROOT}/llvm-objcopy \
    -DCMAKE_OBJDUMP=${PACKAGE_BINROOT}/llvm-objdump \
    -DCMAKE_RANLIB=${PACKAGE_BINROOT}/llvm-ranlib \
    -DCMAKE_READELF=${PACKAGE_BINROOT}/llvm-readelf \
    -DCMAKE_STRINGS=${PACKAGE_BINROOT}/llvm-strings \
    -DCMAKE_STRIP=${PACKAGE_BINROOT}/llvm-strip \
    -DCMAKE_SHARED_LINKER_FLAGS="${LLD_COMMON_ARGS}" \
    "$@"
