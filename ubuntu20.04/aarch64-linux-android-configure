#!/bin/bash

ANDROID_NDK=${PACKAGE_ROOT}/android-ndk-r21d
ANDROID_NDK_BINDIR=${ANDROID_NDK}/toolchains/llvm/prebuilt/${BUILD_KERNEL}-${BUILD_PROCESSOR}/bin
AS=${ANDROID_NDK_BINDIR}/${HOST_PROCESSOR}-${HOST_KERNEL}-${HOST_OS}-as
AR=${ANDROID_NDK_BINDIR}/${HOST_PROCESSOR}-${HOST_KERNEL}-${HOST_OS}-ar
CC=${ANDROID_NDK_BINDIR}/${HOST_PROCESSOR}-${HOST_KERNEL}-${HOST_OS}${HOST_OS_API_LEVEL}-clang
CPP="${CC} -E"
CXX=${CC}++
LD=${ANDROID_NDK_BINDIR}/${HOST_PROCESSOR}-${HOST_KERNEL}-${HOST_OS}-ld
NM=${ANDROID_NDK_BINDIR}/${HOST_PROCESSOR}-${HOST_KERNEL}-${HOST_OS}-nm
OBJCOPY=${ANDROID_NDK_BINDIR}/${HOST_PROCESSOR}-${HOST_KERNEL}-${HOST_OS}-objcopy
OBJDUMP=${ANDROID_NDK_BINDIR}/${HOST_PROCESSOR}-${HOST_KERNEL}-${HOST_OS}-objdump
RANLIB=${ANDROID_NDK_BINDIR}/${HOST_PROCESSOR}-${HOST_KERNEL}-${HOST_OS}-ranlib
READELF=${ANDROID_NDK_BINDIR}/${HOST_PROCESSOR}-${HOST_KERNEL}-${HOST_OS}-readelf
SIZE=${ANDROID_NDK_BINDIR}/${HOST_PROCESSOR}-${HOST_KERNEL}-${HOST_OS}-size
STRIP=${ANDROID_NDK_BINDIR}/${HOST_PROCESSOR}-${HOST_KERNEL}-${HOST_OS}-strip
STRINGS=${ANDROID_NDK_BINDIR}/${HOST_PROCESSOR}-${HOST_KERNEL}-${HOST_OS}-strings

OPTIMIZATION_LEVEL=${OPTIMIZATION_LEVEL:-z}

"$@" AR=${AR} \
     AS=${AS} \
     CC=${CC} \
     CFLAGS="-flto -O${OPTIMIZATION_LEVEL} ${CFLAGS}" \
     CPP="${CPP}" \
     CXX=${CXX} \
     CXXFLAGS="-flto -O${OPTIMIZATION_LEVEL} ${CXXFLAGS}" \
     LD=${LD} \
     LDFLAGS="-flto -lc++_shared -s -O2 ${LDFLAGS}" \
     LIBTOOLFLAGS="-avoid-version" \
     NM=${NM} \
     OBJDUMP=${OBJDUMP} \
     PKG_CONFIG_PATH=${PACKAGE_PREFIX}/lib/pkgconfig \
     RANLIB=${RANLIB} \
     READELF=${READELF} \
     SIZE=${SIZE} \
     STRIP=${STRIP} \
     STRINGS=${STRINGS} \
    --build=${BUILD_PROCESSOR}-${BUILD_KERNEL}-${BUILD_OS} \
    --host=${HOST_PROCESSOR}-${HOST_KERNEL}-${HOST_OS}
